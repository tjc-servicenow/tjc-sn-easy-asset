<?xml version="1.0" encoding="UTF-8"?>
<record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <client_script><![CDATA[function($scope,$http,$timeout,spUtil) {
  /* widget controller */
  var c = this;
	
	$scope.submitted = false;
	$scope.submitButtonText = $scope.data.messages.submit;
	$scope.submit = function() {
		var url = '/api/x_tjc_easy_asset/easyasset/create?' +
			'table=' + $scope.deviceType +
			'&quantity=' + $scope.quantity +
			'&requisition_number=' + $scope.reim;
		$scope.submitted = true;
		$scope.submitButtonText = $scope.data.messages.submitted;
		
		var httpResponse = $http.post(url).then(
			function(result) {
				if (result.data.result.code != 'SUCCESS') {
					spUtil.addErrorMessage('Something went wrong: ' + result.data.result);
					console.log(result);
				}
			}, function(error) {
				var errorMessage = 'Something went wrong: ';
				var errorCode = 'HIPPOPOTAMUS';
				
				if (error.status == 400) {errorCode = 'COAL'}
				if (error.status == 401) {errorCode = 'IRON'}
				if (error.status == 402) {errorCode = 'REDSTONE'}
				if (error.status == 403) {errorCode = 'DIAMONDS'}
				if (error.status == 404) {errorCode = 'VOID'}
				if (error.status == 405) {errorCode = 'LAPIS'}
				if (error.status == 406) {errorCode = 'SANDSTONE'}
				if (error.status == 408) {errorCode = 'GOLD'}
				if (error.status == 409) {errorCode = 'QUARTZ'}
				
				spUtil.addErrorMessage(errorMessage + errorCode);
				console.log(error);
			}
		);
	}
}]]></client_script>
        <controller_as>c</controller_as>
        <css/>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>easy_asset_create</id>
        <internal>false</internal>
        <link/>
        <name>Easy Asset Create</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
	data.messages = {};
	data.messages.submit = gs.getMessage('Submit');
	data.messages.submitted = gs.getMessage('Submitted');
	
	/* Creates the values for the device type dropdown */
	var tableList = new GlideTableHierarchy('cmdb_ci').getAllExtensions();
	data.cmdbChoices = [];
	
	var tables = new GlideRecord('sys_db_object');
	tables.orderBy('label');
	tables.addQuery('name', 'IN', tableList.join(','));
	tables.query();
	
	while (tables.next()) {
		var o = {};
		o.label = tables.getDisplayValue();
		o.name = tables.getValue('name');
		data.cmdbChoices.push(o);
	}
})();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>jha</sys_created_by>
        <sys_created_on>2017-11-09 21:40:23</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>ea96770213920f44c6f5ff82e144b052</sys_id>
        <sys_mod_count>116</sys_mod_count>
        <sys_name>Easy Asset Create</sys_name>
        <sys_package display_value="Easy Asset" source="x_tjc_easy_asset">aaabc5311316cb44c6f5ff82e144b0b9</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Easy Asset">aaabc5311316cb44c6f5ff82e144b0b9</sys_scope>
        <sys_update_name>sp_widget_ea96770213920f44c6f5ff82e144b052</sys_update_name>
        <sys_updated_by>jha</sys_updated_by>
        <sys_updated_on>2017-11-15 22:41:05</sys_updated_on>
        <template><![CDATA[<div>
  <div class="form-group">
    <label for="deviceType">Please choose the device type:</label>
    <select id="tableChoice" class="form-control" ng-model="deviceType" required="required">
      <option value="">--NONE--</option>
      <option ng-repeat="cmdbChoice in data.cmdbChoices" value="{{cmdbChoice.name}}">{{cmdbChoice.label}}</option>
    </select>
  </div>
  
  <div class="form-group">
    <label for="quantity">Quantity:</label>
    <input ng-model="quantity" type="number" value="1" class="form-control">
  </div>
  
  <div class="form-group">
    <label for="reqn">Requisition Number</label>
    <input ng-model="reim" type="text" class="form-control">
  </div>
  
  <button class="btn btn-primary btn-block" ng-disabled="submitted" ng-click="submit()">
    {{submitButtonText}}
  </button>

</div>]]></template>
    </sp_widget>
</record_update>
